openapi: 3.1.3
info:
   title: CloudFileStorage
   description: Это простой проект, который представляет собой многопользовательское файловое облоко. Пользователи сервиса могут использовать его для загрузки и хранения файлов.
   version: 1.0.0
servers:
  - url: 91.199.147.74:8080/api   
    description: Основной сервер
paths:
  /resource:
    get:
      summary: Возвращает информацию о объекте хранения
      tags:
        - ResourceController
      parameters:
        - in: query
          name: path
          required:  true
          schema: 
            type: string
            example: "newFolder/first.docx"
          description: Путь до объекта хранения. Путь до директории должен заканчиваться '/'
      responses:
        "200":
          description: Информация о объекте хранения
          content:
            application/json:
              schema: 
                $ref: "#/components/schemas/StorageObject"                   
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/notFoundResource"       
        "500":
          $ref: "#/components/responses/InternalServerError"
    post:
      summary: Загрузка файлов
      tags:
      - ResourceController
      parameters:
        - in: query
          name: path
          required: true
          schema: 
            type: string
            example: newFolder/
          description: Путь куда будет загружен файл
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                object:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: список файлов для загрузки
      responses:
        "201":
          description: Файлы успешно загружены
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/StorageObject"
              example:
                - name: "first.docx"
                  path: "newFolder/"
                  type: "FILE"
                  size: 1024
                - name: "second.docx"
                  path: "newFolder/"
                  type: "FILE"
                  size: 1024
        "409":
          $ref: "#/components/responses/resourceIsExist"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"
    delete:
      summary: удаление объектов хранения
      tags:
        - ResourceController
      parameters:
        - in: query
          name: path
          required: true
          schema: 
            type: string
            example: "newFolder/first.docx"
          description: путь до объекта который нужно удалить
      responses:
        "204":
          description: "Объект был удален"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/notFoundResource"       
        "500":
          $ref: "#/components/responses/InternalServerError"
  
  /resource/download:
    get:
      summary: скачивание файлов
      description: для папки вернется zip архив
      tags:
        - ResourceController
      parameters:
        - in: query
          name: path
          required: true
          schema: 
            type: string
            example: "newFolder/first.docx"
          description: путь до объекта который нужно скачать
      responses:
        "200":
          description: "объект был скачан"
          content:
            application/octet-stream:
              schema: 
                type: string
                format: binary
              example: 
                "Файл в бинарном виде"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/notFoundResource"       
        "500":
          $ref: "#/components/responses/InternalServerError"
  /resource/move:
    get:
      summary: перемещение объектов хранения
      description: для переименования объекта также использовать этот метод
      tags:
        - ResourceController
      parameters:
        - in: query
          name: from
          required: true
          schema: 
            type: string
            example: "newFolder/first.docx"
          description: Путь для объекта который нужно перемистить/переименовать
        - in: query
          name: to
          required: true
          schema:
            type: string
            example: "newFolder/second.docx"
      responses:
        "200":
          description: Объект был перемещен/изменен. Возвращает объект после изменения
          content:
            application/json:
              schema: 
                $ref: "#/components/schemas/StorageObject" 
              example: 
                name: "Second.docx"
                path: "newFolder/"
                type: "FILE"
                size: 1024
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/notFoundResource"
        "409":
          $ref: "#/components/responses/resourceIsExist"      
        "500":
          $ref: "#/components/responses/InternalServerError"
  /resource/search:
    get:
      summary: Поиск по объектам
      tags:
        - ResourceController
      parameters:
        - in: query
          name: query
          description: Поисковый запрос
          required: true
          schema: 
            type: string
            example: "new"
      responses:
        "200":
          description: Поиск прошел успешно. В ответе результаты поиска
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/StorageObject"
              example:
                - name: "newerDocument.docx"
                  path: ""
                  type: "FILE"
                  size: 1024
                - name: "newFolder/"
                  path: "folder/"
                  type: "DIRECTORY"
                  size: null
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /directory:
    get:
      summary: Получение содержимого папки
      tags:
        - DirectoryController
      parameters:
        - in: query
          name: path
          description: Путь к папке
          required: true
          schema:
            type: string
            example: newFolder/
      responses:
        "200":
          description: Объекты успешно получены
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/StorageObject"
              example:
                - name: "folder/"
                  path: "newFolder/"
                  type: "DIRECTORY"
                  size: null
                - name: "second.docx"
                  path: "newFolder/"
                  type: "FILE"
                  size: 1024
        "404":
          description: Папка не найдена
          content:
            application/json:
              schema: 
                $ref: "#/components/schemas/ErrorMessage"
              example: 
                message: "newFolder/ is not found"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError" 
    post:
      summary: создание пустой папки
      tags:
        - DirectoryController
      parameters:
        - in: query
          name: path
          description: путь до папки, которую нужно создать
          required: true
          schema:
            type: string
            example: newFolder/folder/
      responses:
        "200":
          description: "Папка успешно создана"
          content:
            application/json:
              schema: 
                $ref: "#/components/schemas/StorageObject"
              example: 
                name: "folder/"
                path: "newFolder/"
                type: "DIRECTORY"
                size: null
        "409":
          description: "Папка уже существует"
          content:
            application/json:
              schema: 
                $ref: "#/components/schemas/ErrorMessage"
              example: 
                message: "newFolder/folder/ is exist"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError" 

  /auth/sign-up:
    post:
      summary: Регистрация пользователя
      tags:
        - SecurityController
      requestBody:
        description: Данные для регистрации
        required: true
        content:
          application/json:
            schema: 
              $ref: "#/components/schemas/UserRequest"
      responses:
        "201":
          description: Пользователь успешно зарегистрирован
          content:
            application/json:
              schema: 
                $ref: "#/components/schemas/UserResponse"
        "409":
          description: Пользователь с таким логином уже существует
          content:
            application/json:
              schema: 
                $ref: "#/components/schemas/ErrorMessage"
              example: 
                message: "Пользователь с логином admin уже существует"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /auth/sign-in:
    post:
      summary: Авторизация пользователя
      tags:
        - SecurityController
      requestBody:
        description: Данные для авторизации
        required: true
        content:
          application/json:
            schema: 
              $ref: "#/components/schemas/UserRequest"
      responses:
        "200":
          description: Пользователь успешно авторизован
          content:
            application/json:
              schema: 
                $ref: "#/components/schemas/UserResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /user/me:
    get:
      summary: Получение текущего пользователя
      tags:
        - UserController
      responses:
        "200":
          description: Получен текущий пользователь
          content:
            application/json:
              schema: 
                $ref: "#/components/schemas/UserResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

components:
  schemas:
    StorageObject:
      type: object
      properties:
        name:
          type: string
          example: "first.docx"
        path:
          type: string
          example: "newFolder/"
        type:
          type: string
          enum: [DIRECTORY, FILE]
        size:
          type: integer
          example: 1024
          description: размер возвращается в КБ
    ErrorMessage:
      type: object
      properties:
        message:
          type: string
    UserRequest:
      type: object
      properties:
        username:
          type: string
          example: "admin"
        password:
          type: string
          example: "admin"
    UserResponse:
      type: object
      properties:
        username:
          type: string
          example: "admin"
  examples:
    FirstDoc:
      value:
        name: "first.docx"
        path: "newFolder/"
        type: "FILE"
        size: 1024
    SecondDoc:
      value:
        name: "second.docx"
        path: "newFolder/"
        type: "FILE"
        size: 1024
  responses:
    Unauthorized:
      description: Пользователь не авторизован
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorMessage"
          example:
            message: "Пользователь не авторизован"
    InternalServerError:
      description: Ошибка на стороне сервера
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorMessage"
          example:
            message: "Внутрения ошибка"
    notFoundResource:
      description: Объект не был найден
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorMessage"
          example: 
            message: "newFolder/first.docx is not found"
    resourceIsExist:
      description: Файлы уже существуют по указанному пути
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorMessage"
          example:
            message: "newFolder/first.docx is exist"
